<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="planningpoker.css">
	<script>function setCookie() 
{
    document.cookie = "name=" + document.getElementById("txtName").value;
    window.localStorage.setItem("name", document.getElementById("txtName").value)
}
function getCookie() 
{
    document.getElementById("txtName").value = window.localStorage.getItem("name");
                        
}
document.addEventListener("DOMContentLoaded", function() {
      document.getElementById("welcome").innerHTML = 
       window.localStorage.getItem("name");
});
;</script>
</head>
<body>
    <script type = "text/javascript">
        function doSendMessage() {
            sendMessage(JSON.stringify({
                "username":   window.localStorage.getItem("name"),
                "message": document.getElementById("messages").value
                }));
        }
        function sendMessage(msg){
            waitForSocketConnection(ws, function(){
                ws.send(msg);
           });
        }
        function waitForSocketConnection(socket, callback){
            setTimeout(
                function () {
                    if (socket.readyState === 1) {
                        if(callback != null){
                            callback();
                       }
                        return;
                   } else {
                        waitForSocketConnection(socket, callback);
                   }
               }, 5); 
                
        function openSocket(url) {
            var ws = new WebSocket(url);
            ws.onopen = function() {
            };
            ws.onmessage = function (evt) {
                let json = JSON.parse(evt.data);
                console.log(json)
            }
        }
                }
         function WebSocketTest() {
            
            if ("WebSocket" in window) {
               
               ws = new WebSocket("ws://localhost:8080/ws");
				
               ws.onopen = function() {
                  
                  ws.send("Message to send");
               };
				
               ws.onmessage = function (evt) { 
                var received_msg = evt.data;
                var para = document.createElement("p");                       
                var t = document.createTextNode(received_msg);      
                para.appendChild(t);                                          
                document.getElementById("myDIV").appendChild(para);           
               };
				
               ws.onclose = function() { 
                  
               };
            } else {
              
            }
         } 
        WebSocketTest(); 
      </script>
	<h1>Scrum poker</h1>
	<p class="one">Joined users:</p>
            <div id="myDIV">
    <label id = "user" for="_user" value="customvalue"><b>Chat</b></label>
    <textarea rows="4" cols="50" id = "messages" type="text" placeholder="Write.." name="uname" required></textarea>
    <button onclick="doSendMessage()"> Send </button>
</div>
	<p style="color:green" id ="welcome" class ="three"></p>
	<p class="two">Discussion:</p>

</body>
</html>